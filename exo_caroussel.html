<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Carousel</title>
    <link rel="stylesheet" href="./assets/css/carousel.css">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://raw.githack.com/playoutprod/2020-3wa-react01/master/01_FORMULAIRES_LIFTINGUP/exercices/slider/slider.css"
          media="all"/>
</head>
<body>
    <div id="root"></div>
    <!-- compilation JSX => JS -->
    <script type="text/babel">
    const jsondata = "https://raw.githubusercontent.com/RChrys/React_first-app/master/sliderData.json"


    class App extends React.Component{
        
        constructor(props) {
            super(props);
        }

        render(){
            return (
                <SlideShow/>                
            )
        }
    }
    
    class SlideShow extends React.Component{
        constructor(props){
            super(props);
            this.url = jsondata
            this.dataJson = null
            this.state = {
                preloaded: false,
                current: 0
            }
            
        }

        onLoad = (datajson) => {
            this.dataJson = datajson
            this.setState({
                preloaded: true
            })
        }

        render(){
            return(
                <div>
                    <div className={"layer" + (this.state.preloaded ? "hide" : "")}>
                        <Loading url={this.url} onload={this.onLoad}/>
                    </div>
                    <div className="layer content">
                        <View/>
                    </div>
                </div>
            )
        }

    }

    class Loading extends React.Component{
        constructor(props){
            super(props)
            this.data = null
            this.state = {
                dataLoaded: false,
                imagesLoaded: false
            }
        }

        loadData = (url) => {
            fetch(url)
                .then(response => {
                    return response.json();
                })
            .then(data=>{
                this.data = data
                this.setState({
                    dataLoaded: true
                })
                this.data.images.forEach(image =>{
                    image.loaded = false
                    const img = new Image()
                    img.src = `${this.data.path}/${this.data.full_folder}/${image.name}.${this.data.extension}?raw=true`
                    console.log("je passe la")
                    img.onload = () => {
                        console.log("je passe ici")
                        image.loaded = true
                        this.checkImagesLoaded()
                    }
                })

            })
        }

        checkImagesLoaded = () => {
            if (!this.data.images.find(image => image.loaded === false)) {
                this.setState({ imagesLoaded: true });

                this.props.onload(this.data);
            }


        }

  
        render(){
            return(
                <div id="loader-1" className="loader"></div>
            )
        }

        componentDidMount = () => {
            this.loadData(this.props.url)
        }
    }

    class View extends React.Component{
        constructor(props){
            super(props)
        }

        render(){
            return(
                <div>
                    
                </div>
            )
        }
    }

    class Arrows extends React.Component{
        constructor(props){
            super(props)
        }

        render(){
            return(
                <div>
                    
                </div>
            )
        }
    }

    class Controls extends React.Component{
        constructor(props){
            super(props)
        }

        render(){
            return(
                <div>
                    
                </div>
            )
        }
    }

    class ImageList extends React.Component{
        constructor(props){
            super(props)
        }

        render(){
            return(
                <div>
                    
                </div>
            )
        }
    }
    // TODO
    
    const container = document.getElementById('root');
    

    ReactDOM.render(
        <App />,
        container
    );


    
    </script>
</body>
</html>